name: "Build Node.js application"
description: "This allow to build your Node.js application"

inputs:
  nodeVersion:
    required: false
    default: "25"
    description: "Node.js version to use"
  command:
    required: false
    default: "build"
    description: "Specify what is the command to build"
  pnpmVersion:
    required: false
    description: "PNPM version to use (step skipped when not set)"
  workingDirectory:
    required: false
    default: "."
    description: "Directory to run build commands in"
  checkout:
    required: false
    default: "true"
    description: "Whether to checkout the repository (set to false if already done in a previous step)"

runs:
  using: "composite"
  steps:
  - if: inputs.checkout == 'true'
    name: Checkout repository
    uses: actions/checkout@v6

  #- name: Validate package manager
  #  run: |
  #    case "${{ inputs.packageManager }}" in
  #      npm|yarn|pnpm) ;;
  #      *) echo "::error::packageManager must be one of: npm, yarn, pnpm. Got: ${{ inputs.packageManager }}"; exit 1 ;;
  #    esac
  #  shell: bash

  - name: Use Node.js ${{ inputs.nodeVersion }}
    uses: actions/setup-node@v6
    with:
      node-version: ${{ inputs.nodeVersion }}

  - name: Setup PNPM
    if: inputs.pnpmVersion != ''
    uses: pnpm/action-setup@41ff72655975bd51cab0327fa583b6e92b6d3061 # v4.2.0
    with:
      version: ${{ inputs.pnpmVersion }}

  - name: Install package manager handler
    run: npm i -g @antfu/ni --force
    shell: bash

  - name: Install dependencies
    run: ni
    shell: bash
    working-directory: ${{ inputs.workingDirectory }}

  - name: Build applications
    run: nr ${{ inputs.command }}
    shell: bash
    working-directory: ${{ inputs.workingDirectory }}
